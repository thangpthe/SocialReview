@using Microsoft.AspNetCore.Identity
@model SocialReview.Models.Comment
@inject UserManager<User> UserManager
@{
    // Lấy ID người dùng hiện tại (cách này an toàn ở Partial View)
    var currentUserId = UserManager.GetUserId(ViewContext.HttpContext.User);
    var isOwner = (currentUserId != null && Model.UserId.ToString() == currentUserId);

    // Đếm số lượng reaction (chúng ta sẽ load bằng JS, ở đây để 0)
    var likeCount = Model.Reactions?.Count(r => r.Type == "Like") ?? 0;
}

<div class="comment-card" id="comment-@Model.CommentID">
    @* ... *@

    <div class="comment-body">
        <div class="comment-header">
            <span class="font-semibold text-sm">@(Model.User?.UserName ?? "Người dùng")</span>
            <span class="text-xs text-gray-400">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
        </div>

        <p class="text-sm text-[--text-gray] leading-relaxed comment-content">@Model.CommentContent</p>

        <div class="comment-actions">
            <button class="action-btn-xs btn-react-comment"
                    data-comment-id="@Model.CommentID"
                    data-type="Like">
                <i class="fa-regular fa-thumbs-up"></i>
                Thích (<span class="like-count">@likeCount</span>)
            </button>

            @if (isOwner)
            {
                <button class="action-btn-xs btn-edit-comment"
                        data-comment-id="@Model.CommentID">
                    Sửa
                </button>
                <button class="action-btn-xs btn-delete-comment"
                        data-comment-id="@Model.CommentID"
                        data-type="Report">
                    Xóa
                </button>
            }

            <button class="action-btn-xs btn-react-comment"
                    data-comment-id="@Model.CommentID"
                    data-type="Report">
                Báo cáo
            </button>
        </div>
    </div>
</div>