@model SocialReview.ViewModels.EditProfileViewModel

<div id="edit-profile-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" aria-labelledby="modal-title" role="dialog" aria-modal="true">

    <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full">

        <div class="flex justify-between items-center mb-4">
            <!-- ... existing code ... -->
            <button id="btn-close-modal" type="button" class="text-gray-500 text-2xl hover:text-gray-800">&times;</button>
        </div>

        <!-- THAY ĐỔI: Thêm enctype="multipart/form-data" -->
        <form id="edit-profile-form" asp-action="EditProfile" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()

            <!-- ... (Validation Summary và Input Email giữ nguyên) ... -->
            <div asp-validation-summary="ModelOnly" class="text-red-600 mb-4"></div>

            <div class="mb-4">
                <!-- ... existing code ... -->
                <input asp-for="Email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100" readonly />
            </div>

            <div class="mb-4">
                <!-- ... (Input FullName giữ nguyên) ... -->
                <input asp-for="FullName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500" />
                <span asp-validation-for="FullName" class="text-red-600 text-sm"></span>
            </div>

            <!-- === THAY ĐỔI LỚN BẮT ĐẦU === -->
            <!-- 1. Hiển thị ảnh đại diện HIỆN TẠI -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Ảnh đại diện hiện tại</label>
                <div class="mt-1">
                    @if (!string.IsNullOrEmpty(Model.UserAvatar))
                    {
                        <img src="@Model.UserAvatar" alt="Avatar hiện tại"
                             class="w-24 h-24 rounded-full object-cover border-4 border-gray-200"
                             onerror="this.onerror=null; this.src='https.placehold.co/100x100/eee/333?text=?';">
                    }
                    else
                    {
                        <!-- Ảnh fallback nếu user chưa có avatar -->
                        <div class="w-24 h-24 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center text-3xl font-bold border-4 border-gray-200">
                            ?
                        </div>
                    }
                </div>
            </div>

            <!-- 2. Input UPLOAD FILE MỚI (thay thế input URL cũ) -->
            <div class="mb-6">
                <label asp-for="AvatarFile" class="block text-sm font-medium text-gray-700"></label>
                <input asp-for="AvatarFile" type="file" accept="image/png, image/jpeg"
                       class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-md cursor-pointer bg-gray-50 focus:outline-none
                              file:bg-purple-600 file:text-white file:font-medium file:border-0 file:py-2 file:px-4 file:mr-4
                              hover:file:bg-purple-700" />
                <span asp-validation-for="AvatarFile" class="text-red-600 text-sm"></span>
            </div>

            <!-- 3. XÓA BỎ input cho UserAvatar (URL) -->
            <!-- === KẾT THÚC THAY ĐỔI === -->


            <div class="flex items-center justify-end gap-4">
                <!-- ... (Các nút Hủy và Lưu giữ nguyên) ... -->
                <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-purple-700 transition-colors">
                    <i class="fas fa-save mr-1"></i> Lưu thay đổi
                </button>
            </div>
        </form>
    </div>
</div>